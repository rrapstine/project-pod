# yaml-language-server: $schema=https://raw.githubusercontent.com/LucasPickering/slumber/refs/tags/v4.0.1/schemas/collection.json

name: Project Pod API Tests

profiles:
  local:
    name: Local Development
    data:
      host: http://api.project-pod.test
      api_version: v1

requests:
  # Health & System Checks
  health:
    name: Health Check
    method: GET
    url: "{{ host }}/{{ api_version }}/health"
    headers:
      Accept: application/json

  csrf_token:
    name: Get CSRF Token
    method: GET
    url: "{{ host }}/sanctum/csrf-cookie"
    headers:
      Accept: application/json

  # Authentication Flow
  auth:
    name: Authentication Tests
    requests:
       register:
         name: User Registration
         method: POST
         url: "{{ host }}/register"
         headers:
           Accept: application/json
         body:
           type: json
           data:
             name: "Test User"
             email: "test@example.com"
             password: "password123"
             password_confirmation: "password123"

      login_success:
        name: Login - Valid Credentials
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "test@example.com"
            password: "password123"

      login_invalid_email:
        name: Login - Invalid Email Format
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "invalid-email"
            password: "password123"

      login_wrong_credentials:
        name: Login - Wrong Credentials
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "wrong@example.com"
            password: "wrongpassword"

      login_missing_password:
        name: Login - Missing Password
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "test@example.com"

      logout:
        name: User Logout
        method: POST
        url: "{{ host }}/logout"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"

  # Input Validation Tests
  validation:
    name: Input Validation Tests
    requests:
      login_short_password:
        name: Login - Password Too Short
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "test@example.com"
            password: "123"

      login_empty_fields:
        name: Login - Empty Fields
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data: {}

      login_no_email:
        name: Login - Missing Email
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            password: "password123"

  # Edge Cases
  edge_cases:
    name: Edge Case Tests
    requests:
      login_sql_injection:
        name: Login - SQL Injection Attempt
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "'; DROP TABLE users; --"
            password: "password123"

      login_xss_attempt:
        name: Login - XSS Attempt
        method: POST
        url: "{{ host }}/login"
        headers:
          Accept: application/json
          X-XSRF-TOKEN: "{{ response('csrf_token') | cookie('XSRF-TOKEN') }}"
        body:
          type: json
          data:
            email: "<script>alert('xss')</script>@test.com"
            password: "password123"
